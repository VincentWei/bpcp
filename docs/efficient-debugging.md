## 第十二讲：高效调试

- 时间：2022 年 1 月 29 日（周六）17：30
- 地点：微信视频号“考鼎录”直播间
- [预约或回放](#/grand-finale)

		
## 提纲

1. 高效调试的基本原则
1. C 程序常见错误分类
1. 内存使用错误的表现
1. 善用调试工具

		
## 高效调试的基本原则

1. 多读代码、读懂代码
1. 不要慌，不要怀疑一切，尤其不要轻易怀疑编译工具链
1. 快速找到第一现场，理清现象和缺陷的内在关联
   - 复原现场，形成完整的证据链
   - 知其然，更要知其所以然
1. 避免使用低效调试手段

		
## C 程序常见错误分类

1. 编译、链接错误（5%）
1. 算法或逻辑错误（20%）
1. 内存使用错误（70%）
1. 疑难杂症（5%）

	
### 编译、链接错误

1. 编译错误
   - 始终解决第一个错误
   - 正确理解编译器给出的错误描述
1. 链接错误：未找到某某符号
   - 正确的函数库（包括版本）和库搜索路径
   - 静态链接时，根据函数库依赖关系，调整函数库顺序

	
### 算法或逻辑错误

- 主要靠读代码和单元测试

	
### 内存使用错误

1. 堆使用错误
1. 栈使用错误

	
### 疑难杂症

1. 命名污染，导致调用错误的函数或者使用错误的全局变量
1. 整数溢出
1. 异步数据访问
   - Unix 系统中的信号处理
   - 多线程程序中出现竞态（race-condition）

		
## 内存使用错误的表现

	
### 堆使用错误（1）

1) 缓冲区溢出

	
### 堆使用错误（2）

2) 使用无效地址（野指针或者已释放的地址）

	
### 堆使用错误（3）

3) 内存泄露（忘记释放）

	
### 堆使用错误（4）

4) 两次释放

	
### 堆使用错误（5）

5) 释放非堆中分配的地址

	
### 堆使用错误（6）

6) 堆管理算法对错误现象的影响

	
### 栈使用错误（1）

1) 缓冲区溢出

	
### 栈使用错误（2）

2) 栈溢出

	
### 栈使用错误（3）

3) 可变参数的副作用

		
## 常用调试工具和技巧

1. gdb：程序挂在哪儿了？
1. efence：程序是否有堆使用错误？
1. valgrind：是否存在内存泄露？
1. 打桩

	
### gdb

	
### efence

	
### valgrind

	
### 打桩

		
## Q & A

